<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Fixing a bug in the Haskell installer - rand[om]</title><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest"><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Fixing a bug in the Haskell installer">
<meta itemprop="description" content="The story of a bug fix. I found a bug in the default Haskell installer ghcup, fixed it in my computer and had the fix merged to the public installer.">
<meta itemprop="datePublished" content="2020-01-16T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-01-16T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="415">



<meta itemprop="keywords" content="haskell,ghcup,open source,git,gitlab,github," /><meta property="og:title" content="Fixing a bug in the Haskell installer" />
<meta property="og:description" content="The story of a bug fix. I found a bug in the default Haskell installer ghcup, fixed it in my computer and had the fix merged to the public installer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ricardoanderegg.com/posts/fixing_ghcup_bug/" />
<meta property="article:published_time" content="2020-01-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-16T00:00:00+00:00" /><meta property="og:site_name" content="rand[om]" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fixing a bug in the Haskell installer"/>
<meta name="twitter:description" content="The story of a bug fix. I found a bug in the default Haskell installer ghcup, fixed it in my computer and had the fix merged to the public installer."/>
<link href="https://rsms.me/inter/inter.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" media="screen" href="https://ricardoanderegg.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ricardoanderegg.com/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://ricardoanderegg.com/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ricardoanderegg.com/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ricardoanderegg.com/">
				<img src="https://ricardoanderegg.com/img/bike.jpg" alt="rand[om]" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ricardoanderegg.com/">rand[om]</a></h1>
	<div class="site-description"><p>med âˆ© ml</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/polyrand" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/ricardoanderegg/" title="LinkedIn"><i data-feather="linkedin"></i></a></li><li><a href="https://twitter.com/ricardoanderegg" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://t.me/polyrand" title="Telegram"><i data-feather="send"></i></a></li><li><a href="mailto:ricardo.anderegg@gmail.com" title="Mail"><i data-feather="mail"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/posts">Blog</a>
			</li>
			
			<li>
				<a href="/thoughts">Thoughts</a>
			</li>
			
			<li>
				<a href="/page/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-headersingle">
				<div class="matter">
					<h1 class="title">Fixing a bug in the Haskell installer</h1>
				</div>
				
					<div class="meta">
						<div class="date">
							
							<span class="restpost">Jan 2020</span>
						</div>
					</div>
				
			</div>
					
			<div class="markdown">
				<p>The story of a bug fix. I found a bug in the default Haskell installer <a href="https://gitlab.haskell.org/haskell/ghcup">ghcup</a>, fixed it in my computer and had the fix merged to the public installer.</p>
<p>I started doing the MIT course <a href="http://brendanfong.com/programmingcats.html">Programming with Categories</a> so I had to install Haskell on my computer. But following the recommended method kept throwing me an error: <code>mktemp: too few X's in template â€˜ghcupâ€™</code>. After some time searching I could only find 1 discussion where someone had had a similar problem.</p>
<p>After learning a bit about <a href="https://www.gnu.org/software/coreutils/manual/html_node/mktemp-invocation.html">mktemp</a> and digging into the installer <a href="https://gitlab.haskell.org/haskell/ghcup/blob/master/ghcup">script</a>, I discovered that different versions of mktemp had different behaviours. In my case I had two installed, the one coming by default with macOS, placed in <code>/usr/bin</code> and a different one installed by brew when installing <a href="https://formulae.brew.sh/formula/coreutils">coreutils</a>.</p>
<p>I modified the installer script like so:</p>
<p><code>mktemp -d -t ghcup</code> =&gt; <code>mktemp -d -t ghcup.XXXXXXX</code></p>
<p>Everything suddenly worked. I openned an issue and a <a href="https://gitlab.haskell.org/haskell/ghcup/merge_requests/137">pull request in the ghcup repository</a>, and a few hours later it was merged!</p>
<p>The only problem we could think of was breaking the installer for other mac OS / OS X versions, and that&rsquo;s something I also asked myself at first.</p>
<p>My guess is that &ldquo;ghcup.XXXXXXX&rdquo; would be evaluated as a string anyway, the same way &ldquo;ghcup&rdquo; alone is evaluated. I&rsquo;m currently not planning to upgrade to the latest macOS version, so I couldn&rsquo;t test it with macOS Catalina or with older versions. I made some tests on my computer though:</p>
<p>Using <strong>native</strong> mktemp, the one that comes with macOS (<code>/usr/bin/mktemp</code>):</p>
<ul>
<li>
<p><code>/usr/bin/mktemp -d -t ghcup.XXXX</code> creates a folder named: <em>ghcup.XXXX.r2OBbQRF</em></p>
</li>
<li>
<p><code>/usr/bin/mktemp -d -t ghcupXXXX</code> (without the dot) creates a folder named: <em>ghcupXXXX.wEPBMrGh</em></p>
</li>
<li>
<p><code>/usr/bin/mktemp -d -t ghcup</code> (the one that runs in macOS <strong>without</strong> coreutils installed) creates a folder named: <em>ghcup.8fAcY5LC</em></p>
</li>
</ul>
<p>Using <strong>coreutils</strong> (GNU) mktemp v. 8.31, the default one in my computer, installed with homebrew (<code>/usr/local/opt/coreutils/libexec/gnubin/mktemp</code>):</p>
<ul>
<li>
<p><code>mktemp -d -t ghcup.XXXX</code> creates a folder named: <em>ghcup.7Gwj</em></p>
</li>
<li>
<p><code>mktemp -d -t ghcup.XXXX</code> (without the dot) creates a folder named: <em>ghcup3jJS</em></p>
</li>
<li>
<p><code>mktemp -d -t ghcup</code>(the one throwing the error) returns: <em>mktemp: too few X&rsquo;s in template â€˜ghcupâ€™</em></p>
</li>
</ul>
<p>After the merge I tried installing Haskell with the default installation <a href="https://www.haskell.org/ghcup/">method/command</a> and boom ðŸ’¥, everything worked smoothly.</p>
<p>I know this is a very subtle bug that did not requiere extensive research for months to fix, but maybe someone else had, could, or will run into the same problem; and thinking that this could be the fix for it makes me feel really good ðŸ˜„.</p>
			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li>
								<a href="/tags/haskell">haskell</a>
							</li>
							
							<li>
								<a href="/tags/ghcup">ghcup</a>
							</li>
							
							<li>
								<a href="/tags/open-source">open source</a>
							</li>
							
							<li>
								<a href="/tags/git">git</a>
							</li>
							
							<li>
								<a href="/tags/gitlab">gitlab</a>
							</li>
							
							<li>
								<a href="/tags/github">github</a>
							</li>
							
						</ul>
					
				
			</div>

			
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2020  <a href="https://github.com/polyrand/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
