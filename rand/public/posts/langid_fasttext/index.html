<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Language identification with fastText - rand[om]</title><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest"><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Language identification with fastText">
<meta itemprop="description" content="When dealing with a multilingual dataset doing language identification is a very important part of the analysis process, here I&rsquo;ll show a way to do a fast ⚡️ and reliable ✨ languague identification with fasttext.">
<meta itemprop="datePublished" content="2019-08-20T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-08-20T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="608">



<meta itemprop="keywords" content="fasttext,nlp,text,language,identification,classification," /><meta property="og:title" content="Language identification with fastText" />
<meta property="og:description" content="When dealing with a multilingual dataset doing language identification is a very important part of the analysis process, here I&rsquo;ll show a way to do a fast ⚡️ and reliable ✨ languague identification with fasttext." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ricardoanderegg.com/posts/langid_fasttext/" />
<meta property="article:published_time" content="2019-08-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-20T00:00:00+00:00" /><meta property="og:site_name" content="rand[om]" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Language identification with fastText"/>
<meta name="twitter:description" content="When dealing with a multilingual dataset doing language identification is a very important part of the analysis process, here I&rsquo;ll show a way to do a fast ⚡️ and reliable ✨ languague identification with fasttext."/>
<link href="https://rsms.me/inter/inter.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" media="screen" href="https://ricardoanderegg.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ricardoanderegg.com/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://ricardoanderegg.com/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ricardoanderegg.com/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ricardoanderegg.com/">
				<img src="https://ricardoanderegg.com/img/bike.jpg" alt="rand[om]" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ricardoanderegg.com/">rand[om]</a></h1>
	<div class="site-description"><p>med ∩ ml</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/polyrand" title="Github"><i data-feather="github"></i></a></li><li><a href="https://www.linkedin.com/in/ricardoanderegg/" title="LinkedIn"><i data-feather="linkedin"></i></a></li><li><a href="https://twitter.com/ricardoanderegg" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://t.me/polyrand" title="Telegram"><i data-feather="send"></i></a></li><li><a href="mailto:ricardo.anderegg@gmail.com" title="Mail"><i data-feather="mail"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/posts">Blog</a>
			</li>
			
			<li>
				<a href="/thoughts">Thoughts</a>
			</li>
			
			<li>
				<a href="/page/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-headersingle">
				<div class="matter">
					<h1 class="title">Language identification with fastText</h1>
				</div>
				
					<div class="meta">
						<div class="date">
							
							<span class="restpost">Aug 2019</span>
						</div>
					</div>
				
			</div>
					
			<div class="markdown">
				<p>When dealing with a multilingual dataset doing language identification is a very important part of the analysis process, here I&rsquo;ll show a way to do a fast ⚡️ and reliable ✨ languague identification with <a href="https://fasttext.cc">fasttext</a>.</p>
<p><strong>TL;DR</strong></p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">import</span> fasttext

lid_model = fasttext.load_model(<span style="color:#0ff;font-weight:bold">&#39;lid.176.bin&#39;</span>)

<span style="color:#fff;font-weight:bold">def</span> detector(text):
    <span style="color:#007f7f"># return empty string if there is no tweet</span>
    <span style="color:#fff;font-weight:bold">if</span> text.isspace():
        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>
    <span style="color:#fff;font-weight:bold">else</span>:
        <span style="color:#007f7f"># get first item of the prediction tuple, then split by &#34;__label__&#34; and return only language code</span>
        <span style="color:#fff;font-weight:bold">return</span> lid_model.predict(text)[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">0</span>].split(<span style="color:#0ff;font-weight:bold">&#34;__label__&#34;</span>)[<span style="color:#ff0;font-weight:bold">1</span>]
    
df[<span style="color:#0ff;font-weight:bold">&#39;language&#39;</span>] = df[<span style="color:#0ff;font-weight:bold">&#39;Tweet&#39;</span>].apply(detector)
</code></pre></div><p>First we need to download a dataset to play with. We&rsquo;ll use the <a href="https://github.com/Kaggle/kaggle-api">kaggle CLI tool</a>. Run the following command after installing it or download the dataset <a href="https://www.kaggle.com/rtatman/the-umass-global-english-on-twitter-dataset">directly from kaggle</a>.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kaggle datasets download -d rtatman/the-umass-global-english-on-twitter-dataset
</code></pre></div><div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">import</span> pandas <span style="color:#fff;font-weight:bold">as</span> pd

df = pd.read_csv(<span style="color:#0ff;font-weight:bold">&#39;the-umass-global-english-on-twitter-dataset.zip&#39;</span>, sep=<span style="color:#0ff;font-weight:bold">&#39;</span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold">&#39;</span>)
df.head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">print</span>(f<span style="color:#0ff;font-weight:bold">&#34;&#34;&#34;There are: {df.Tweet.shape[0]} tweets.
</span><span style="color:#0ff;font-weight:bold">    
</span><span style="color:#0ff;font-weight:bold">First 10 tweets:
</span><span style="color:#0ff;font-weight:bold">    
</span><span style="color:#0ff;font-weight:bold">{df[&#39;Tweet&#39;].head(10)}&#34;&#34;&#34;</span>)
</code></pre></div><pre><code>There are: 10502 tweets.
    
First 10 tweets:
    
0                            Bugün bulusmami lazimdiii
1       Volkan konak adami tribe sokar yemin ederim :D
2                                                  Bed
3    I felt my first flash of violence at some fool...
4              Ladies drink and get in free till 10:30
5                     @Melanynijholtxo ahhahahahah dm!
6                                                 Fuck
7    Watching #Miranda On bbc1!!! @mermhart u r HIL...
8                                       @StizZsti fino
9            Shopping! (@ Kohl's) http://t.co/I8ZkQHT9
Name: Tweet, dtype: object
</code></pre>
<p>Looking at the first 10 tweets we can already see the are multiple languags been used. Lets now use fasttext to classify them. You need to download the language indentification model to use it, run the following shell command if you need to do so.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.bin
</code></pre></div><p>Alternatively, you can use a slightly less accurate but a lot smaller model:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.ftz
</code></pre></div><p>And now we can use it.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">import</span> fasttext

lid_model = fasttext.load_model(<span style="color:#0ff;font-weight:bold">&#39;lid.176.bin&#39;</span>)
</code></pre></div><p>Create a list in which each item is a tweet.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">corpus = df[<span style="color:#0ff;font-weight:bold">&#39;Tweet&#39;</span>].to_list()
</code></pre></div><p>Predict the language of the first tweet.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tweet = corpus[<span style="color:#ff0;font-weight:bold">0</span>]
prediction = lid_model.predict(corpus[<span style="color:#ff0;font-weight:bold">0</span>])
<span style="color:#fff;font-weight:bold">print</span>(f<span style="color:#0ff;font-weight:bold">&#34;Text:</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> </span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold"> {tweet} </span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> </span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> Prediction:</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> </span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold"> {prediction}&#34;</span>)
</code></pre></div><pre><code>Text:
     Bugün bulusmami lazimdiii 
 
 Prediction:
     (('__label__tr',), array([0.77383512]))
</code></pre>
<p>The output of the prediction is a tuple of language label and prediction confidence. Language label is a string with “_<em>label</em>_” followed by ISO 639 code of the language. You can check the language codes <a href="https://www.loc.gov/standards/iso639-2/php/code_list.php">here</a> and the languages supported by fasttext at the end of <a href="https://fasttext.cc/blog/2017/10/02/blog-post.html">their blog post</a>.</p>
<p>Lets try with a different one.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">print</span>(f<span style="color:#0ff;font-weight:bold">&#34;Text:</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> </span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold"> {corpus[4]} </span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> </span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> Prediction:</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold"> </span><span style="color:#0ff;font-weight:bold">\t</span><span style="color:#0ff;font-weight:bold"> {lid_model.predict(corpus[4])}&#34;</span>)
</code></pre></div><pre><code>Text:
     Ladies drink and get in free till 10:30 
 
 Prediction:
     (('__label__en',), array([0.65553886]))
</code></pre>
<p>Now we can create a new column with the langue of each tweet.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">def</span> detector(text):
    <span style="color:#007f7f"># return empty string if there is no tweet</span>
    <span style="color:#fff;font-weight:bold">if</span> text.isspace():
        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>
    <span style="color:#fff;font-weight:bold">else</span>:
        <span style="color:#007f7f"># get first item of the prediction tuple, then split by &#34;__label__&#34; and return only language code</span>
        <span style="color:#fff;font-weight:bold">return</span> lid_model.predict(text)[<span style="color:#ff0;font-weight:bold">0</span>][<span style="color:#ff0;font-weight:bold">0</span>].split(<span style="color:#0ff;font-weight:bold">&#34;__label__&#34;</span>)[<span style="color:#ff0;font-weight:bold">1</span>]
</code></pre></div><div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">%%time
df[<span style="color:#0ff;font-weight:bold">&#39;language&#39;</span>] = df[<span style="color:#0ff;font-weight:bold">&#39;Tweet&#39;</span>].apply(detector)
</code></pre></div><pre><code>CPU times: user 258 ms, sys: 4.17 ms, total: 262 ms
Wall time: 266 ms
</code></pre>
<p>I added the <code>%%time</code> IPython <a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html">command</a> to show one of the main reasons to use fasttext, the speed ⚡️. <strong>In 250ms I processed 10502 tweets</strong> working on a 2016 laptop with a dual-core 2 GHz Intel Core i5 processor.</p>
<p>The speed of fastText can also be compared with <a href="https://github.com/saffsd/langid.py">langid.py</a> in this table from their <a href="https://fasttext.cc/blog/2017/10/02/blog-post.html">blog</a>.</p>
<p><img src="https://fasttext.cc/img/blog/2017-10-02-blog-post-img1.png" alt=""></p>
<p>Finally, if we wanted to work only with a subset of the languages and convert the rest to <em>&ldquo;unk&rdquo;</em> (and maybe use a multilingual model when working with them), we can use the following.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#007f7f"># keep the 4 top languages according to the current predictions</span>
languanges_keep = df.language.value_counts().index[:<span style="color:#ff0;font-weight:bold">4</span>].to_list()

<span style="color:#007f7f"># create a custom list</span>
languanges_keep = [<span style="color:#0ff;font-weight:bold">&#34;en&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;es&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;pt&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;ja&#34;</span>]

df.loc[df.language.apply(<span style="color:#fff;font-weight:bold">lambda</span> x: x not in languanges_keep), <span style="color:#0ff;font-weight:bold">&#39;language&#39;</span>] = <span style="color:#0ff;font-weight:bold">&#34;unk&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df.language.value_counts()
</code></pre></div><pre><code>en     5735
unk    2247
es     1139
pt      876
ja      505
Name: language, dtype: int64
</code></pre>
<p>And from here we can keep working with our text data!</p>
			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li>
								<a href="/tags/fasttext">fasttext</a>
							</li>
							
							<li>
								<a href="/tags/nlp">nlp</a>
							</li>
							
							<li>
								<a href="/tags/text">text</a>
							</li>
							
							<li>
								<a href="/tags/language">language</a>
							</li>
							
							<li>
								<a href="/tags/identification">identification</a>
							</li>
							
							<li>
								<a href="/tags/classification">classification</a>
							</li>
							
						</ul>
					
				
			</div>

			
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2019  <a href="https://github.com/polyrand/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
